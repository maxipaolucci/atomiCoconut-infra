files:
  /home/ec2-user/install-cloudwatch-agent.sh:
    mode: "000755"
    owner: ec2-user
    group: ec2-user
    content: |
      #!/bin/bash
      
      # install cloudwatch agent
      sudo yum install amazon-cloudwatch-agent
      
      # get cloudwatch agent config from s3
      aws s3 cp s3://atomicoconut/infrastructure/config-files.zip config-files.zip
      unzip config-files.zip
      rm config-files.zip


commands:
  01-install-cloudwatch-agent:
    command: sudo -H -u ec2-user bash -c './install-cloudwatch-agent.sh'
    cwd: /home/ec2-user
  02-remove-install-cloudwatch-agent-script:
    command: sudo -H -u ec2-user bash -c 'rm install-cloudwatch-agent.sh'
    cwd: /home/ec2-user
    